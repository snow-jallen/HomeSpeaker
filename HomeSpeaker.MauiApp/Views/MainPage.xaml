<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HomeSpeaker.MauiApp.ViewModels"
             x:Class="HomeSpeaker.MauiApp.Views.MainPage"
             x:DataType="vm:MainViewModel"
             Title="HomeSpeaker">

    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto" Padding="20">
        <!-- Server Selection -->
        <VerticalStackLayout Grid.Row="0" Spacing="10">
            <Label Text="Select Server:" FontSize="18" FontAttributes="Bold"/>
            <Grid ColumnDefinitions="*,Auto">
                <Picker Grid.Column="0" 
                        ItemsSource="{Binding Servers}" 
                        SelectedItem="{Binding SelectedServer}"
                        ItemDisplayBinding="{Binding Nickname}"
                        Title="Choose a server"/>
                <Button Grid.Column="1" 
                        Text="+" 
                        Command="{Binding AddServerCommand}"
                        WidthRequest="50"
                        Margin="10,0,0,0"/>
            </Grid>
        </VerticalStackLayout>

        <!-- Playlists Section -->
        <VerticalStackLayout Grid.Row="1" Spacing="10" Margin="0,20,0,0">
            <Grid ColumnDefinitions="*,Auto">
                <Label Grid.Column="0" 
                       Text="Playlists:" 
                       FontSize="18" 
                       FontAttributes="Bold"
                       VerticalOptions="Center"/>
                <Button Grid.Column="1" 
                        Text="Refresh" 
                        Command="{Binding LoadPlaylistsCommand}"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InvertedBoolConverter}}"/>
            </Grid>
        </VerticalStackLayout>

        <!-- Playlist List -->
        <ScrollView Grid.Row="2" Margin="0,10,0,0">
            <VerticalStackLayout BindableLayout.ItemsSource="{Binding Playlists}" Spacing="10">
                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <Frame BorderColor="LightGray" 
                               CornerRadius="5" 
                               Padding="15"
                               HasShadow="True">
                            <Grid ColumnDefinitions="*,Auto">
                                <Label Grid.Column="0" 
                                       FontSize="16"
                                       VerticalOptions="Center">
                                    <Label.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=PlayPlaylistCommand}" CommandParameter="{Binding .}"/>
                                    </Label.GestureRecognizers>
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="{Binding PlaylistName}"/>
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>
                                <Button Grid.Column="1" 
                                        Text="â–¶" 
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:MainViewModel}}, Path=PlayPlaylistCommand}"
                                        CommandParameter="{Binding .}"
                                        WidthRequest="50"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Loading Indicator -->
        <ActivityIndicator Grid.Row="3" 
                          IsRunning="{Binding IsLoading}"
                          IsVisible="{Binding IsLoading}"
                          Margin="0,10,0,0"/>

        <!-- Status Message -->
        <Label Grid.Row="4" 
               Text="{Binding StatusMessage}"
               FontSize="14"
               TextColor="Gray"
               HorizontalTextAlignment="Center"
               Margin="0,10,0,0"/>
    </Grid>

</ContentPage>
